F.context("staticController").run(function(){var t=require("common:widget/ui/passport/passport.js"),e=require("common:widget/ui/dialog/dialog.js"),a=require("common:widget/new_header/cart/cart.js"),n="/uc/user/addmycart";$(function(){function i(){r(),z.ajaxGetAdInfoHandler(),d&&(z.handleSpecNavCeiling(),h&&z.handleSee2seeCeiling()),o()}function o(){require.async(["detail:widget/ui/change_pic/change_pic.js"],function(t){t.init()})}function r(){s.on("click",".j-ctrl span, .j-ctrl",T.buyCountCtrlClickHandler).on("keyup","input",T.buyCountInputKeyupHandler),$(".j-btn-buy").on("click",T.buyBtnClickHandler),$(".btn-add-cart").on("click",T.add2cartBtnClickHandler),d&&c.on("scroll",T.winScrollHandler)}var l=F.context("girlsHdDlgDetail");l+""=="1"&&new e.alert({width:520,title:"提示",content:"该团购3.7元秒杀已结束，您可用原团购价购买。",customClassName:"ui-dialog-girls-act-detail"}).center();var s=$(".j-item-buycount-row"),d=!0;if($.browser.msie&&$.browser.version<9&&(d=!1),d){var c=$(window),u=c.scrollTop(),p=$("#j-see2see"),h=p.size()>0;if(h)var f=p.offset().top,g=$("body").height()-$(".w-footer").outerHeight()-p.outerHeight();var m=$("#j-sn-ceiling"),v=m.offset()&&m.offset().top||0,w=!1,x=1}var y=$(".item-buy-area .animate-to-cart"),C=$(".btn-add-cart"),b=$("#bar-cart-container"),j=b.offset();if(j&&y.length&&C.length)var k=b.width(),H=y.parent().offset(),B=y.width(),I=y.height(),S=j.left+k/2-H.left-B/2,N=j.top-H.top;var A=function(t){return 0!==t.errno?void _():(y.css({display:"block"}).animate({left:S+"px",top:N+"px",width:.8*B+"px",height:.8*I+"px",opacity:.9},1e3).animate({top:N-30+"px",width:.7*B+"px",height:.7*I+"px",opacity:.7},150).animate({top:N+"px",width:.6*B+"px",height:.6*I+"px",opacity:.6},100).animate({top:N-15+"px",width:.5*B+"px",height:.5*I+"px",opacity:.5},100).animate({top:N-5+"px",width:.4*B+"px",height:.4*I+"px",opacity:.4},100).animate({top:N+"px",opacity:.3},50).animate({opacity:0},500,function(){C.removeAttr("disabled"),y.css({display:"none",left:"200px",top:"-50px",width:B,height:I,opacity:1})}),void a.add2cart(2e3))},_=function(){C.removeAttr("disabled"),e.alert({width:520,title:"提示",content:"加入购物车失败",customClassName:"ui-dialog-girls-act-detail"}).center()},E=function(t){C.attr("disabled","true");var e=$.ajax({url:n,data:t,type:"POST",dataType:"json"});e.then(A,_)},T={buyCountCtrlClickHandler:function(t){var e=$(t.target);if(e.hasClass("j-ctrl")||(e=e.parent(),t.stopPropagation()),!e.hasClass("disabled")){var a=e.siblings("input"),n=a.val();a.val(e.hasClass("plus")?++n:--n),z.checkBuyCountAndSetErr(),z.updateBuyCount()}},buyCountInputKeyupHandler:function(t){var e=$(t.target),a=parseInt(e.val(),10);isNaN(a)&&(a=0),e.val(a),z.checkBuyCountAndSetErr(),z.updateBuyCount()},buyBtnClickHandler:function(e){var a=$(this),n=parseInt(s.find('input[type="text"]').val(),10),i=a.attr("href");!isNaN(n)&&n>0&&(i+=i.indexOf("?")>-1?"&count="+n:"?count="+n,a.attr("href",i)),e.preventDefault(),t.check(function(){a.hasClass("j-some-btn-buy")&&((new Image).src="//hm.baidu.com/hm.gif?ep=%7Bid%3Aljgm%2CeventType%3Aclick%7D&et=1&nv=0&si=1ecc32f16b509b4859e79015ab9a9598&st=4&v=pixel-1.0&rnd="+Math.floor(Math.random()*Math.pow(2,31))),window.location.href=i},function(){t.show({u:a.attr("href")})})},add2cartBtnClickHandler:function(){var e=s.find('input[type="text"]').val()||1,a={dealInfo:[{dealId:C.attr("data-deal"),dealNum:+e}]};t.check(function(){E(a)},function(){t.show()})},winScrollHandler:function(){u=c.scrollTop(),g=$("body").height()-$(".w-footer").outerHeight()-p.outerHeight(),z.handleSpecNavCeiling(),h&&z.handleSee2seeCeiling()}},z={ajaxGetAdInfoHandler:function(){var t=F.context("nuomi_base")+"/mis/ad/ad?adarea_id=9,26";$.ajax({url:t,dataType:"jsonp",jsonp:"jsonp_callback",success:function(t){function e(t,e,a){if(t&&t.length>0){for(var n=0;n<t.length;++n){var i=t[n];e.append('<a class="ad-link" href="'+i.url+'" class="link" target="_blank" mon="element=adver_'+i.id+"&position=adver_"+(n+1)+'"><img src="'+i.img+'" alt="'+i.title+'"width="227" height="'+a+'"/></a>')}e.show()}}e(t.data[26],$("#detail-right-ad-first"),187),e(t.data[9],$("#detail-right-ad"),238)}})},updateBuyCount:function(){$row=s;var t=$row.find('[type="text"]'),e=t.siblings(".plus"),a=t.siblings(".minus"),n=$row.data("min"),i=$row.data("max"),o=t.val();n>=o?(a.addClass("disabled"),o=n):a.removeClass("disabled"),o>=i?(e.addClass("disabled"),o=i):e.removeClass("disabled"),t.val(o)},checkBuyCountAndSetErr:function(){$row=s;var t=$row.data("min"),e=$row.data("max"),a=$row.data("stock"),n=$row.data("personmax"),i=$row.find('[type="text"]'),o=i.val(),r=!1;return this.setBuyCountErr(""),t>o?(this.setBuyCountErr("每人最少购买"+t+"件"),location.hash="j-tableGoods"):o>e?this.setBuyCountErr(a>=n?"每人最多购买"+n+"件":"库存不足，最多可购买"+a+"件"):r=!0,r},setBuyCountErr:function(t){s.find(".j-err-wrap").html(t)},handleSee2seeCeiling:function(){f>u?(x="static",p.css({position:"static",top:"auto",zIndex:"auto"})):u>f&&g>u?(x="fixed",p.css({position:"fixed",top:w?51:0,zIndex:50})):(x="absolute",p.css({position:"absolute",top:g}))},handleSpecNavCeiling:function(){if(u>v){if(w)return;w=!0,m.addClass("spec-nav-fixed"),m.css({position:"fixed",top:0,zIndex:55})}else{if(!w)return;w=!1,m.removeClass("spec-nav-fixed"),m.css({position:"static",top:"auto",zIndex:"auto"})}},getUrlParam:function(t){var e=window.location.search;if(e){var a=new RegExp("(^|&|\\?)"+t+"=(([^&#]*)(&|#|$))"),n=e.match(a);return null!=n?n[2]:null}return null}};i()})});