var Slider=require("common:widget/ui/slider/slider.js"),sticky=require("common:widget/dep/moye/sticky.js"),template=require("common:widget/ui/template/template.js").template,etpl=require("common:widget/dep/etpl/main.js"),tplAjax=$("#sub-bottom").html(),scrollspy=require("common:widget/ui/scrollspy/scrollspy.js"),LazyLoad=require("common:widget/ui/lazyload/lazyload.js"),itemHover=require("list:widget/new_list/item.js");$(function(){function t(t,e,a){$("#"+t).html(template(e,a))}function e(){$("#j-t10logo-box").find(".t10-logo img").each(function(){var t,e,a=$(this);$("<img/>").attr("src",$(a).attr("src")).load(function(){t=this.width,e=this.height,t/140>e/75?$(a).css("width","140px").css("height","auto"):$(a).css("height","75px").css("width","auto")})})}function a(){var t=$("#j-ad-pointers");t.size()>0&&"none"===t.css("display")||require.async(["common:widget/ui/sliderbar/sliderbar.js"],function(t){new t({container:$("#j-rightAdContainer"),pageNumber:$("#j-ad-pointers a"),pageNumberHover:"hover",direction:"opacity",interval:5e3,callback:function(){this.pageNumber.hover(function(){$(this).trigger("click")})}})})}function i(){var t="#sticky-panel",e=$(t);if(e.length){scrollspy(t);var a=($(window).height()-e.height())/2;sticky(t,{top:a,bottomGap:270}),e.find("a").on("click",function(t){var e=$(this),a=e.attr("href");$("html, body").animate({scrollTop:$(a).offset().top},500),t.preventDefault()})}}function o(t,e,a){"undefined"==typeof a&&(a="click"),t.on(a,function(a){t.removeClass("active"),$(this).addClass("active"),e.hide();var i=t.index($(this));e.eq(i).show(),a.preventDefault()})}$(".tab-nav li a").eq(0).addClass("active");{var n="/pcindex/index/indexhotajax",l="//t10.nuomi.com/pc/t10/ajaxt10deals?is_homepage=1",s="//t10.nuomi.com/pc/t10/ajaxt10deals?is_homepage=0&pn=20";location.protocol+"//"+location.hostname+":"+location.port+"/pcindex/index/indexbuttomlinkajax"}$(".close-bottom-ad").click(function(){$(".bottom-ad").hide()});var r=($(window).width(),new Slider("j-sliders",{autoScroll:{interval:5e3,enable:!0},fx:{duration:100,type:"slide"},exposureLog:!0}));r.len>1&&(r.start(),$(".slide-holder").on({mouseenter:function(){r.stop(),$(".slide-prev").show(),$(".slide-next").show()},mouseleave:function(){r.start(),$(".slide-prev").hide(),$(".slide-next").hide()}})),$(".slide-next").on("click",function(t){r.moveRight(),t.preventDefault()}),$(".slide-prev").on("click",function(t){r.moveLeft(),t.preventDefault()}),i();var c={getTimes:function(t,e){var a=e-t,i=Math.floor(a/864e5),o=a%864e5,n=Math.floor(o/36e5),l=o%36e5,s=Math.floor(l/6e4),r=l%6e4,c=Math.floor(r/1e3),d=function(t){return 10>1*t?"0"+t:t};return{day:i,hour:n,minutes:s,seconds:c,format:n+s+c>0?[d(n),d(s),d(c)].join(":"):"",min:n>0?60*n+s:s}},ajaxLoadHandler:function(e){if(0===e.errno){{var i=e.data,o=(i.sArr||{},i.hotRange),n=i.rightAd,l=i.hotTopic,s=i.adLowerRight;i.rankItems,i.visitItems&&i.visitItems.detail?i.visitItems.detail:[]}o?t("j-hotRange","tplHotRange",{list:o}):$("#j-hotRange .mid-list").append('<li class="dis-gray">无热门商圈</li>');var r=5;n instanceof Array&&n.length>0?(n.length>3&&(n.length=3),r-=n.length,t("j-rightAd","tplRightAd",{list:n}),a()):$("#j-rightAd").hide(),l instanceof Array&&l.length>0&&t("j-hotTopic","tplHotTopic",{list:l}),s instanceof Array&&s.length>0&&t("j-hotMall","tplHotMall",{list:s})}},getJingxuan:function(t){if(0===t.errno)if(t=t.data,t.t10Deals.total>3){var e=t.t10Deals.list;$("#j-jxContainer").html(template("tplJingxuan",{list:e,s:t.s_deals,st:"{s:"+t.s_deals+",tid:"+(t.t10Deals.tid?t.t10Deals.tid:"")+"}"})),c.countdown(t.t10Deals.period)}else window.isNoT10JingXuan=!0,$("#sticky-refer").hide()},getT10logo:function(t){if(0===t.errno)if(t=t.data,t.t10Deals.total>0){var a=c.getImageNum(t.t10Deals.list),i=template("tplT10logo",{list:t.t10Deals.list,imageNum:a});$("#j-t10logo-box").html(i)}else window.isNoT10JingXuan=!0,$("#sticky-refer").hide();e()},getT10NormalLogo:function(){$("#j-t10logo-box").html(template("tplT10logo",{imageNum:0}))},getT10JingxuanComplete:function(){window.t10JingxuanComplete=!0},getImageNum:function(t){var e=0;for(var a in t){var i=t[a];""!==i.na_logo&&e++}return e},countdown:function(t){var e=$("#j-jxTimer"),a=t.scene,i=t.periodIndex-1,o=a[i],n=null,l=a.length,s="",r="header-e",d="",m=new Date,p=a[0]&&a[0].starttime?a[0].starttime:"10:00:00";p=p.substr(0,p.indexOf(":"));var g=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1,p).getTime(),u=setInterval(function(){n=(new Date).getTime(),s="",o?n>=o.StartTimeStamp&&n<=o.EndTimeStamp?(s=r,d=c.getTimes(n,o.EndTimeStamp).format):n>o.EndTimeStamp?(i+=1,o=a[i],o?d=c.getTimes(n,o.StartTimeStamp).format:i>=l?d=c.getTimes(n,g).format:clearInterval(u)):d=c.getTimes(n,o.StartTimeStamp).format:d=c.getTimes(n,g).format,d=d.split(":"),e.html(['<span class="t">',d[0],"</span>",'<span class="t">',d[1],"</span>",'<span class="t">',d[2],"</span>"].join(""));var t=e.parents(".top-title");""!==s?t.hasClass(r)||t.addClass(r):t.removeClass(r)},1e3)}};$.ajax(0===parseInt(F.context("isSACity"),10)?{type:"get",async:!1,url:l,dataType:"jsonp",jsonp:"jsonp_callback",jsonpCallback:"jsonp_callback",success:c.getJingxuan,complete:c.getT10JingxuanComplete}:{type:"get",url:s,dataType:"jsonp",jsonp:"jsonp_callback",jsonpCallback:"jsonp_callback",success:c.getT10logo,error:c.getT10NormalLogo,complete:c.getT10JingxuanComplete}),$.getJSON(n,c.ajaxLoadHandler),o($(".tab-nav li a"),$(".bottom-content"))});